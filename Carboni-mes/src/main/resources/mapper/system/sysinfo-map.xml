<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.carboni.prj.system.mapper.SysinfoMapper">
	<select id="selectSysAll" resultType="co.carboni.prj.system.vo.SystemVO">	
			SELECT 
			    S.SINUM, S.SINAME, S.SISAFTEM, 
			    P.PIONE, P.PITWO, P.PITHREE, P.PIFOUR,
			    D.PHDMKAM, D.PHDERRAM
			FROM SYSINFO S, PROCINFO P, PROCHEAD_D D
			WHERE s.sinum = p.sinum(+) 
			    and s.picodeid = d.picodeid(+)
			ORDER BY SINUM
		
	</select>

	<select id="selectSysDetAll" resultType="co.carboni.prj.system.vo.SystemVO">
			SELECT 
			    S.SINUM, S.SINAME, S.SISAFTEM, 
			    M.SMSTATUS, M.SMMNTEND, M.SIMAINT, M.SIDATE, M.SIDIE, M.SYSADMIN,
			    P.PIONE, P.PITWO, P.PITHREE, P.PIFOUR,
			    D.PHDMKAM, D.PHDERRAM
			FROM SYSINFO S, SYSMAN M, PROCINFO P, PROCHEAD_D D
			WHERE S.SINUM = M.SINUM(+) 
			    AND S.SINUM = P.SINUM(+) 
			    AND S.PICODEID = D.PICODEID(+)
			    AND S.SINUM = #{sinum}
			ORDER BY SINUM
	</select>
	
	<select id="selectPicoid" resultType="co.carboni.prj.system.vo.SystemVO">
		SELECT PICODEID, PINAME FROM PROCINFO
	</select>
	<!-- 설비 가동상태 -->
	<select id="selectSysCondition" resultType="co.carboni.prj.system.vo.SystemVO">
		SELECT SMSTATUS FROM SYSMAN 
		WHERE SINUM= #{sinum}
	</select>
	
	<!-- 설비 가동시작일 가동종료일 -->
	<select id="selectSysStartDie" resultType="co.carboni.prj.system.vo.SystemVO">
	SELECT SIDATE, SIDIE FROM SYSMAN 
	WHERE SINUM= #{sinum}
	</select>
	
	<!-- 전체 남은 수명중 현재 진행중 수명 -->
	<select id="selectSysLifespan" resultType="co.carboni.prj.system.vo.SystemVO">
	SELECT SIDATE, TRUNC(SIDIE-SIDATE),TRUNC(100-((SIDIE-SYSDATE)/(SIDIE-SIDATE)*100), 3), SIDIE, TRUNC(SIDIE-SYSDATE) FROM SYSMAN
	WHERE SINUM = #{sinum}
	</select>
	
	<!-- 입고일, 점검주기, 다음점검일 -->
	<select id="selectMaint" resultType="co.carboni.prj.system.vo.SystemVO">
		SELECT SIMAINT, SIDATE,(SIDATE+SIMAINT) NEXTDAT
		FROM SYSMAN
		WHERE SINUM = #{sinum}
	</select>
	
	
	<insert id="systemInsert" parameterType="co.carboni.prj.system.vo.SystemVO">
		INSERT INTO SYSINFO
			VALUES(SYSTEM_SINUM_SEQ.NEXTVAL, #{picodeid}, #{siname}, #{sisaftem})
	</insert>
	<insert id="sysmanInsert" parameterType="co.carboni.prj.system.vo.SystemVO">
		INSERT INTO SYSMAN
		VALUES(SYSTEM_SINUM_SEQ.CURRVAL, SYSTEM_SINUM_SEQ.CURRVAL, DEFAULT, SYSDATE, #{simaint}, SYSDATE, DEFAULT, '')
	</insert>
	<update id="systemUpdate" parameterType="co.carboni.prj.system.vo.SystemVO">
		UPDATE SYSINFO
		<set>
		PICODEID = #{picodeid}
		</set>
		WHERE SINUM = #{sinum}
	</update>
	
	<update id="sysmanUpdate" parameterType="co.carboni.prj.system.vo.SystemVO">
	UPDATE SYSMAN
			<set>
			SMSTATUS = ${smstatus},
			SMMNTEND = SYSDATE,
			SIMAINT = #{simaint},
			SIDIE = #{sidie},
			</set>
	WHERE SMNUM = #{smnum}
	</update>
	
	<delete id="systemDelete">
		DELETE  FROM SYSINFO
		WHERE SINUM = #{sinum}
	</delete>
	
	<delete id="sysmanDelete" parameterType="co.carboni.prj.system.vo.SystemVO">
		DELETE FROM SYSMAN
		WHERE SINUM = #{sinum}
	</delete>
</mapper>
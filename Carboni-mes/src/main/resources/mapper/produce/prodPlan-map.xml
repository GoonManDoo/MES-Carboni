<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.carboni.prj.produce.mapper.ProdPlanMapper">

	<select id="findUnprod" resultType="co.carboni.prj.produce.vo.ProdPlanVO">
		SELECT x.prnum, y.cndate, z.csname, x.prclose
		FROM prodreq x, contract y, costomer z
		WHERE x.cnnum = y.cnnum
		AND y.cscode = z.cscode
		AND x.prclose >= TO_DATE(#{startDt}, 'YYYY/MM/DD')
		AND TO_DATE(#{endDt}, 'YYYY/MM/DD') >= x.prclose
		AND x.prstatus = 'N'
	</select>
	
	<select id="planProduct" resultType="co.carboni.prj.produce.vo.ProdPlanVO">
		SELECT z.gicode, z.giname, z.giunit, x.prnum, x.prclose, y.cnam
		FROM prodreq x, contract y, goodsinfo z
		WHERE y.cnnum = x.cnnum
		AND y.gicode = z.gicode
		AND x.prnum IN
		<foreach collection="orderNum" item="arr" open="(" separator="," close=")">
			#{arr}
		</foreach>
	</select>
	
	<select id="matList" resultType="co.carboni.prj.produce.vo.ProdPlanVO">
		SELECT g.gicode, g.giname, b.micode, m.miname, b.bam, k.msciam, c.cnam
		FROM goodsinfo g, bom b, matinfo m, matstk k, contract c
		WHERE g.gicode = b.gicode
		AND
		b.micode = m.micode
		AND
		m.micode = k.micode
		AND
		g.gicode = #{gic}
		AND
		c.cnam = #{cn}
	</select>
	
	<insert id="requestMat">
		INSERT INTO matreq
		VALUES ('MR-'||TO_CHAR(matreq_REQNUM_seq.nextval), #{micode}, #{orderAmount}, 'N')
	</insert>
	
</mapper>